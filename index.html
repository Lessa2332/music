<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="utf-8">
  <title>–ó –î–Ω–µ–º –ù–∞—Ä–æ–¥–∂–µ–Ω–Ω—è, –í–∞–¥—ñ–∫!</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <style>
    body { margin: 0; overflow: hidden; font-family: Arial, sans-serif; }
    #canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; }
    #startButton { 
      position: absolute; top: 50%; left: 50%; 
      transform: translate(-50%, -50%); 
      padding: 20px 40px; 
      font-size: 24px; 
      background: #ffd700;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      z-index: 10;
      transition: all 0.3s;
    }
    #startButton:hover { background: #ffed4e; transform: translate(-50%, -50%) scale(1.05); }
    #greeting { 
      position: absolute; 
      top: 20%; 
      width: 100%; 
      text-align: center; 
      color: white; 
      font-size: 32px; 
      font-weight: bold;
      text-shadow: 2px 2px 8px rgba(0,0,0,0.8); 
      display: none; 
      z-index: 10;
      padding: 20px;
      background: rgba(0,0,0,0.5);
      border-radius: 10px;
      margin: 0 auto;
      max-width: 80%;
      left: 50%;
      transform: translateX(-50%);
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/three@0.168.0/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands@0.4.1675465757/hands.min.js"></script>
</head>
<body>
  <button id="startButton">üç∑ –ó–∞–ø—É—Å—Ç–∏—Ç–∏ AR-–ø—Ä–∏–≤—ñ—Ç–∞–Ω–Ω—è</button>
  <div id="greeting">–ó –¥–Ω–µ–º –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è, –í–∞–¥—ñ–∫!<br>–ó–∞ —Ç–≤–æ—î –∑–¥–æ—Ä–æ–≤'—è, —É—Å–ø—ñ—Ö–∏ —Ç–∞ –∫—Ä—É—Ç—ñ –ø—Ä–∏–≥–æ–¥–∏! ü•Ç</div>
  <canvas id="canvas"></canvas>
  
  <script>
  (function() {
    'use strict';
    
    let videoElement, scene, camera, renderer, glassGroup;
    let hands, animationId;
    
    function init() {
      // –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –≤—ñ–¥–µ–æ –µ–ª–µ–º–µ–Ω—Ç–∞
      videoElement = document.createElement('video');
      videoElement.style.display = 'none';
      document.body.appendChild(videoElement);
      
      // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è Three.js
      scene = new THREE.Scene();
      camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 100);
      camera.position.z = 2;
      
      renderer = new THREE.WebGLRenderer({ 
        antialias: true, 
        alpha: true,
        canvas: document.getElementById('canvas')
      });
      renderer.setSize(window.innerWidth, window.innerHeight);
      renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
      
      // –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–µ–ª–∏—Ö–∞
      createGlass();
      
      // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è MediaPipe Hands
      initHandTracking();
      
      // –û–±—Ä–æ–±–Ω–∏–∫–∏ –ø–æ–¥—ñ–π
      setupEventListeners();
    }
    
    function createGlass() {
      glassGroup = new THREE.Group();
      
      // –ù—ñ–∂–∫–∞
      const stemGeometry = new THREE.CylinderGeometry(0.02, 0.03, 0.2, 16);
      const stemMaterial = new THREE.MeshPhongMaterial({ color: 0xffd700, shininess: 100 });
      const stem = new THREE.Mesh(stemGeometry, stemMaterial);
      stem.position.y = 0.1;
      glassGroup.add(stem);
      
      // –ß–∞—à–∞
      const bowlGeometry = new THREE.CylinderGeometry(0.08, 0.06, 0.15, 32);
      const bowlMaterial = new THREE.MeshPhysicalMaterial({ 
        color: 0xffffff, 
        transparent: true, 
        opacity: 0.3,
        roughness: 0.1,
        metalness: 0.9,
        transmission: 0.9
      });
      const bowl = new THREE.Mesh(bowlGeometry, bowlMaterial);
      bowl.position.y = 0.275;
      glassGroup.add(bowl);
      
      // –†—ñ–¥–∏–Ω–∞
      const liquidGeometry = new THREE.SphereGeometry(0.06, 32, 32, 0, Math.PI * 2, 0, Math.PI / 2);
      const liquidMaterial = new THREE.MeshPhongMaterial({ 
        color: 0xffcc00, 
        transparent: true, 
        opacity: 0.7,
        shininess: 100
      });
      const liquid = new THREE.Mesh(liquidGeometry, liquidMaterial);
      liquid.position.y = 0.27;
      liquid.scale.y = 0.5;
      glassGroup.add(liquid);
      
      // –û—Å–≤—ñ—Ç–ª–µ–Ω–Ω—è
      const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
      scene.add(ambientLight);
      
      const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
      directionalLight.position.set(5, 5, 5);
      scene.add(directionalLight);
      
      scene.add(glassGroup);
      glassGroup.visible = false;
    }
    
    function initHandTracking() {
      hands = new Hands({
        locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands@0.4.1675465757/${file}`
      });
      
      hands.setOptions({
        maxNumHands: 1,
        modelComplexity: 1,
        minDetectionConfidence: 0.7,
        minTrackingConfidence: 0.7
      });
      
      hands.onResults(onHandResults);
    }
    
    function onHandResults(results) {
      if (results.multiHandLandmarks && results.multiHandLandmarks.length > 0) {
        const landmarks = results.multiHandLandmarks[0];
        
        // –¶–µ–Ω—Ç—Ä –¥–æ–ª–æ–Ω—ñ
        const palmX = (landmarks[0].x + landmarks[9].x) / 2;
        const palmY = (landmarks[0].y + landmarks[9].y) / 2;
        const palmZ = (landmarks[0].z + landmarks[9].z) / 2;
        
        // –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –¥–ª—è Three.js
        const x = (palmX - 0.5) * 3;
        const y = (0.5 - palmY) * 3; // –Ü–Ω–≤–µ—Ä—Ç—É—î–º–æ Y
        const z = palmZ * 2;
        
        glassGroup.position.set(x, y, z);
        glassGroup.visible = true;
        
        // –ê–Ω—ñ–º–∞—Ü—ñ—è –æ–±–µ—Ä—Ç–∞–Ω–Ω—è
        glassGroup.rotation.y += 0.02;
        
        // –î–µ—Ç–µ–∫—Ü—ñ—è pinch –∂–µ—Å—Ç—É
        const thumb = landmarks[4];
        const index = landmarks[8];
        const distance = Math.sqrt(
          Math.pow(thumb.x - index.x, 2) +
          Math.pow(thumb.y - index.y, 2) +
          Math.pow(thumb.z - index.z, 2)
        );
        
        const greeting = document.getElementById('greeting');
        if (distance < 0.05) {
          greeting.style.display = 'block';
          greeting.style.animation = 'fadeIn 0.5s';
          
          // –î–æ–¥–∞—î–º–æ —ñ—Å–∫—Ä–∏ –ø—Ä–∏ pinch
          if (!window.pinchActive) {
            createSparkles();
            window.pinchActive = true;
          }
        } else {
          greeting.style.display = 'none';
          window.pinchActive = false;
        }
      } else {
        glassGroup.visible = false;
        document.getElementById('greeting').style.display = 'none';
      }
    }
    
    function createSparkles() {
      const sparkleCount = 30;
      for (let i = 0; i < sparkleCount; i++) {
        setTimeout(() => {
          const sparkle = document.createElement('div');
          sparkle.style.cssText = `
            position: absolute;
            width: 10px;
            height: 10px;
            background: gold;
            border-radius: 50%;
            pointer-events: none;
            top: ${Math.random() * 100}vh;
            left: ${Math.random() * 100}vw;
            box-shadow: 0 0 20px gold;
            animation: sparkle 1s forwards;
            z-index: 5;
          `;
          document.body.appendChild(sparkle);
          
          setTimeout(() => sparkle.remove(), 1000);
        }, i * 30);
      }
    }
    
    function startCamera() {
      const constraints = {
        video: {
          facingMode: 'user',
          width: { ideal: 1280 },
          height: { ideal: 720 }
        }
      };
      
      navigator.mediaDevices.getUserMedia(constraints)
        .then((stream) => {
          videoElement.srcObject = stream;
          videoElement.play();
          
          // –ó–∞–ø—É—Å–∫ –æ–±—Ä–æ–±–∫–∏ –∫–∞–¥—Ä—ñ–≤
          function processFrame() {
            if (!videoElement.videoWidth) {
              requestAnimationFrame(processFrame);
              return;
            }
            
            hands.send({ image: videoElement });
            requestAnimationFrame(processFrame);
          }
          processFrame();
        })
        .catch((err) => {
          console.error('–ü–æ–º–∏–ª–∫–∞ –∫–∞–º–µ—Ä–∏:', err);
          alert('–ù–µ –≤–¥–∞–ª–æ—Å—è –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ –∫–∞–º–µ—Ä–∏. –î–æ–∑–≤–æ–ª—å—Ç–µ –¥–æ—Å—Ç—É–ø –¥–æ –∫–∞–º–µ—Ä–∏ —Ç–∞ –æ–Ω–æ–≤—ñ—Ç—å —Å—Ç–æ—Ä—ñ–Ω–∫—É.');
        });
    }
    
    function setupEventListeners() {
      document.getElementById('startButton').addEventListener('click', () => {
        document.getElementById('startButton').style.display = 'none';
        startCamera();
      });
      
      window.addEventListener('resize', onWindowResize);
    }
    
    function onWindowResize() {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    }
    
    function animate() {
      animationId = requestAnimationFrame(animate);
      renderer.render(scene, camera);
    }
    
    // –°—Ç–∏–ª—å –¥–ª—è –∞–Ω—ñ–º–∞—Ü—ñ–π
    const style = document.createElement('style');
    style.textContent = `
      @keyframes fadeIn {
        from { opacity: 0; transform: translate(-50%, -20px); }
        to { opacity: 1; transform: translate(-50%, 0); }
      }
      @keyframes sparkle {
        0% { transform: scale(0) rotate(0deg); opacity: 1; }
        100% { transform: scale(1) rotate(360deg); opacity: 0; }
      }
    `;
    document.head.appendChild(style);
    
    // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏
    window.addEventListener('DOMContentLoaded', init);
    window.addEventListener('load', animate);
    
    // –û—á–∏—â–µ–Ω–Ω—è –ø—Ä–∏ –∑–∞–∫—Ä–∏—Ç—Ç—ñ
    window.addEventListener('beforeunload', () => {
      if (animationId) cancelAnimationFrame(animationId);
      if (videoElement.srcObject) {
        videoElement.srcObject.getTracks().forEach(track => track.stop());
      }
    });
    
  })();
  </script>
</body>
</html>
