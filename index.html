<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <title>ü•Ç –ó –î–Ω–µ–º –ù–∞—Ä–æ–¥–∂–µ–Ω–Ω—è, –í–∞–¥—ñ–∫!</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            margin: 0;
            overflow: hidden;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: #000;
        }
        
        /* –í—ñ–¥–µ–æ —è–∫ —Ñ–æ–Ω */
        #videoBackground {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            object-fit: cover;
            transform: scaleX(-1);
            z-index: 1;
            display: none;
        }
        
        /* Canvas –¥–ª—è Three.js –ø–æ–≤–µ—Ä—Ö –≤—ñ–¥–µ–æ */
        #canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 2;
            pointer-events: none;
        }
        
        /* –Ü–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø–æ–≤–µ—Ä—Ö —É—Å—å–æ–≥–æ */
        #startButton {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 20px 40px;
            font-size: 24px;
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            border: none;
            border-radius: 15px;
            cursor: pointer;
            z-index: 10;
            transition: all 0.3s ease;
            color: #000;
            font-weight: bold;
            box-shadow: 0 10px 30px rgba(255, 215, 0, 0.5);
            animation: pulse 2s infinite;
        }
        
        #greeting {
            position: fixed;
            top: 10%;
            left: 50%;
            transform: translateX(-50%);
            width: 90%;
            max-width: 600px;
            text-align: center;
            color: white;
            font-size: clamp(20px, 5vw, 36px);
            font-weight: bold;
            text-shadow: 2px 2px 10px rgba(0,0,0,0.9);
            display: none;
            z-index: 10;
            padding: 25px;
            background: linear-gradient(135deg, rgba(255, 107, 107, 0.9), rgba(255, 183, 77, 0.9));
            border-radius: 20px;
            backdrop-filter: blur(10px);
            border: 3px solid rgba(255, 255, 255, 0.8);
            box-shadow: 0 15px 50px rgba(0,0,0,0.4);
        }
        
        #loading, #error, .instructions {
            position: fixed;
            left: 50%;
            transform: translateX(-50%);
            color: white;
            text-align: center;
            z-index: 10;
            padding: 15px 25px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            background: rgba(0, 0, 0, 0.7);
            display: none;
        }
        
        #loading { top: 10%; font-size: 18px; }
        #error { 
            top: 10%; 
            color: #ff6b6b; 
            font-size: 16px;
            border: 2px solid #ff6b6b;
            max-width: 500px;
            width: 90%;
        }
        .instructions { 
            bottom: 30px; 
            font-size: 16px;
            border: 2px solid #4ecdc4;
            max-width: 400px;
            width: 90%;
        }
        
        /* –ü–∞–Ω–µ–ª—å –Ω–∞–ª–∞–≥–æ–¥–∂–µ–Ω–Ω—è */
        #debugPanel {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.85);
            color: #4ECDC4;
            padding: 12px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            z-index: 100;
            border: 1px solid #4ECDC4;
            max-width: 320px;
            backdrop-filter: blur(5px);
            line-height: 1.5;
        }
        #debugPanel strong { 
            color: #FFD700; 
            font-size: 13px;
            margin-bottom: 5px;
            display: block;
        }
        #debugPanel div { margin: 3px 0; }
        .debug-value { color: #FF8E53; font-weight: bold; }
        .debug-good { color: #4ECDC4; }
        .debug-bad { color: #FF6B6B; }
        
        @keyframes pulse {
            0% { transform: translate(-50%, -50%) scale(1); }
            50% { transform: translate(-50%, -50%) scale(1.05); }
            100% { transform: translate(-50%, -50%) scale(1); }
        }
        
        @keyframes sparkle {
            0% { transform: scale(0) rotate(0deg); opacity: 1; }
            100% { transform: scale(1) rotate(360deg); opacity: 0; }
        }
    </style>
</head>
<body>
    <!-- –í—ñ–¥–µ–æ—Ñ–æ–Ω (—Å–ø–æ—á–∞—Ç–∫—É –ø—Ä–∏—Ö–æ–≤–∞–Ω–æ) -->
    <video id="videoBackground" playsinline></video>
    
    <!-- Canvas –¥–ª—è Three.js -->
    <canvas id="canvas"></canvas>
    
    <!-- –Ü–Ω—Ç–µ—Ä—Ñ–µ–π—Å -->
    <button id="startButton">üéâ –ó–∞–ø—É—Å—Ç–∏—Ç–∏ AR-–ø—Ä–∏–≤—ñ—Ç–∞–Ω–Ω—è</button>
    <div id="greeting">–ó –î–Ω–µ–º –ù–∞—Ä–æ–¥–∂–µ–Ω–Ω—è, –í–∞–¥—ñ–∫!<br>–ó–∞ —Ç–≤–æ—î –∑–¥–æ—Ä–æ–≤'—è, —É—Å–ø—ñ—Ö–∏ —Ç–∞ –∫—Ä—É—Ç—ñ –ø—Ä–∏–≥–æ–¥–∏! ü•Ç</div>
    <div id="loading">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Å–∏—Å—Ç–µ–º–∏ —Ä–æ–∑–ø—ñ–∑–Ω–∞–≤–∞–Ω–Ω—è —Ä—É–∫...</div>
    <div id="error"></div>
    <div class="instructions">üñêÔ∏è –ü–æ–∫–∞–∂—ñ—Ç—å –¥–æ–ª–æ–Ω—é –∫–∞–º–µ—Ä—ñ<br>üëâ –ó–≤–µ–¥—ñ—Ç—å –≤–µ–ª–∏–∫–∏–π —Ç–∞ –≤–∫–∞–∑—ñ–≤–Ω–∏–π –ø–∞–ª—å—Ü—ñ –¥–ª—è —Ç–æ—Å—Ç—É!</div>
    
    <!-- –ü–∞–Ω–µ–ª—å –Ω–∞–ª–∞–≥–æ–¥–∂–µ–Ω–Ω—è -->
    <div id="debugPanel">
        <strong>AR Debug Panel</strong>
        <div>–°—Ç–∞—Ç—É—Å MediaPipe: <span id="debugStatus" class="debug-value">–û—á—ñ–∫—É–≤–∞–Ω–Ω—è...</span></div>
        <div>–†—É–∫ –∑–Ω–∞–π–¥–µ–Ω–æ: <span id="debugHands" class="debug-value">0</span></div>
        <div>–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏: <span id="debugCoords" class="debug-value">0, 0</span></div>
        <div>–ö–µ–ª–∏—Ö: <span id="debugGlass" class="debug-value">–ü—Ä–∏—Ö–æ–≤–∞–Ω–æ</span></div>
        <div>FPS: <span id="debugFPS" class="debug-value">0</span></div>
    </div>

    <!-- –ë—ñ–±–ª—ñ–æ—Ç–µ–∫–∏ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands@0.4.1646424915/hands.min.js"></script>

    <script>
        (function() {
            'use strict';
            
            // DOM-–µ–ª–µ–º–µ–Ω—Ç–∏
            const videoBackground = document.getElementById('videoBackground');
            const canvas = document.getElementById('canvas');
            const startButton = document.getElementById('startButton');
            const greeting = document.getElementById('greeting');
            const loading = document.getElementById('loading');
            const errorDiv = document.getElementById('error');
            const instructions = document.querySelector('.instructions');
            
            // –ï–ª–µ–º–µ–Ω—Ç–∏ –Ω–∞–ª–∞–≥–æ–¥–∂–µ–Ω–Ω—è
            const debugStatus = document.getElementById('debugStatus');
            const debugHands = document.getElementById('debugHands');
            const debugCoords = document.getElementById('debugCoords');
            const debugGlass = document.getElementById('debugGlass');
            const debugFPS = document.getElementById('debugFPS');
            
            // –ì–ª–æ–±–∞–ª—å–Ω—ñ –∑–º—ñ–Ω–Ω—ñ
            let videoForProcessing = null;
            let scene, camera, renderer, glassGroup, hands;
            let isRunning = false;
            let lastPinchTime = 0;
            let frameCount = 0;
            let lastFpsUpdate = 0;
            
            // ====== –Ü–ù–Ü–¶–Ü–ê–õ–Ü–ó–ê–¶–Ü–Ø ======
            function init() {
                try {
                    // –°—Ç–≤–æ—Ä—é—î–º–æ –ø—Ä–∏—Ö–æ–≤–∞–Ω–µ –≤—ñ–¥–µ–æ –¥–ª—è MediaPipe
                    videoForProcessing = document.createElement('video');
                    videoForProcessing.autoplay = true;
                    videoForProcessing.playsInline = true;
                    videoForProcessing.style.display = 'none';
                    document.body.appendChild(videoForProcessing);
                    
                    // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É—î–º–æ Three.js
                    initThreeJS();
                    
                    // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É—î–º–æ MediaPipe Hands
                    initMediaPipe();
                    
                    updateDebugStatus('debug-good', '‚úÖ –°–∏—Å—Ç–µ–º–∞ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–∞');
                    console.log('‚úÖ –°–∏—Å—Ç–µ–º–∞ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–∞');
                } catch (err) {
                    showError('–ü–æ–º–∏–ª–∫–∞ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó: ' + err.message);
                    updateDebugStatus('debug-bad', '‚ùå –ü–æ–º–∏–ª–∫–∞ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó');
                }
            }
            
            // ====== THREE.JS ======
            function initThreeJS() {
                // –°—Ü–µ–Ω–∞
                scene = new THREE.Scene();
                scene.background = null;
                
                // –ö–∞–º–µ—Ä–∞
                camera = new THREE.PerspectiveCamera(
                    60, 
                    window.innerWidth / window.innerHeight, 
                    0.1, 
                    1000
                );
                camera.position.set(0, 0, 5);
                
                // –†–µ–Ω–¥–µ—Ä–µ—Ä
                renderer = new THREE.WebGLRenderer({
                    canvas: canvas,
                    antialias: true,
                    alpha: true,
                    preserveDrawingBuffer: false
                });
                renderer.setSize(window.innerWidth, window.innerHeight);
                renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
                renderer.setClearColor(0x000000, 0);
                
                // –û—Å–≤—ñ—Ç–ª–µ–Ω–Ω—è
                const ambientLight = new THREE.AmbientLight(0xffffff, 0.8);
                scene.add(ambientLight);
                
                const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
                directionalLight.position.set(10, 10, 5);
                scene.add(directionalLight);
                
                // –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–µ–ª–∏—Ö–∞ (—Å–ø—Ä–æ—â–µ–Ω–∞ –≤–µ—Ä—Å—ñ—è –¥–ª—è —Ç–µ—Å—Ç—É)
                createTestGlass();
            }
            
            // ====== 3D-–ö–ï–õ–ò–• (—Å–ø—Ä–æ—â–µ–Ω–∞ —Ç–µ—Å—Ç–æ–≤–∞ –≤–µ—Ä—Å—ñ—è) ======
            function createTestGlass() {
                glassGroup = new THREE.Group();
                
                // –ü—Ä–æ—Å—Ç–∏–π –∫–µ–ª–∏—Ö (–±–µ–∑ –±—É–ª—å–±–∞—à–æ–∫)
                const glassMaterial = new THREE.MeshPhongMaterial({
                    color: 0xFFD700,
                    transparent: true,
                    opacity: 0.9,
                    shininess: 100
                });
                
                // –ß–∞—à–∞ (–∫–æ–Ω—É—Å)
                const cupGeometry = new THREE.ConeGeometry(0.15, 0.3, 32);
                const cup = new THREE.Mesh(cupGeometry, glassMaterial);
                cup.position.y = 0.2;
                glassGroup.add(cup);
                
                // –ù—ñ–∂–∫–∞
                const stemGeometry = new THREE.CylinderGeometry(0.03, 0.03, 0.4, 16);
                const stem = new THREE.Mesh(stemGeometry, glassMaterial);
                stem.position.y = -0.1;
                glassGroup.add(stem);
                
                // –û—Å–Ω–æ–≤–∞
                const baseGeometry = new THREE.CylinderGeometry(0.06, 0.06, 0.05, 16);
                const base = new THREE.Mesh(baseGeometry, glassMaterial);
                base.position.y = -0.3;
                glassGroup.add(base);
                
                scene.add(glassGroup);
                glassGroup.visible = false;
                glassGroup.scale.set(1.5, 1.5, 1.5); // –ó–±—ñ–ª—å—à—É—î–º–æ –¥–ª—è –∫—Ä–∞—â–æ—ó –≤–∏–¥–∏–º–æ—Å—Ç—ñ
            }
            
            // ====== MEDIAPIPE HANDS ======
            function initMediaPipe() {
                hands = new self.Hands({
                    locateFile: (file) => {
                        return `https://cdn.jsdelivr.net/npm/@mediapipe/hands@0.4.1646424915/${file}`;
                    }
                });
                
                hands.setOptions({
                    maxNumHands: 1,
                    modelComplexity: 0, // –ó–º–µ–Ω—à—É—î–º–æ –¥–ª—è —à–≤–∏–¥–∫–æ—Å—Ç—ñ
                    minDetectionConfidence: 0.6,
                    minTrackingConfidence: 0.6
                });
                
                hands.onResults(onHandResults);
            }
            
            // ====== –ó–ê–ü–£–°–ö –ö–ê–ú–ï–†–ò ======
            async function startCamera() {
                try {
                    hideError();
                    loading.style.display = 'block';
                    startButton.style.display = 'none';
                    
                    const constraints = {
                        video: {
                            facingMode: 'user',
                            width: { ideal: 640 }, // –ó–º–µ–Ω—à—É—î–º–æ –¥–ª—è —à–≤–∏–¥–∫–æ—Å—Ç—ñ
                            height: { ideal: 480 },
                            frameRate: { ideal: 30 }
                        }
                    };
                    
                    if (!navigator.mediaDevices?.getUserMedia) {
                        throw new Error('–ë—Ä–∞—É–∑–µ—Ä –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î –∫–∞–º–µ—Ä—É');
                    }
                    
                    // –û—Ç—Ä–∏–º—É—î–º–æ –ø–æ—Ç—ñ–∫ –∑ –∫–∞–º–µ—Ä–∏
                    const stream = await navigator.mediaDevices.getUserMedia(constraints);
                    
                    // –ü—ñ–¥–∫–ª—é—á–∞—î–º–æ –ø–æ—Ç—ñ–∫ –¥–æ –≤—ñ–¥–µ–æ-–µ–ª–µ–º–µ–Ω—Ç—ñ–≤
                    videoBackground.srcObject = stream;
                    videoForProcessing.srcObject = stream;
                    
                    // –ß–µ–∫–∞—î–º–æ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—ñ –≤—ñ–¥–µ–æ
                    await Promise.all([
                        new Promise(resolve => videoBackground.onloadedmetadata = resolve),
                        new Promise(resolve => videoForProcessing.onloadedmetadata = resolve)
                    ]);
                    
                    // –ó–∞–ø—É—Å–∫–∞—î–º–æ –≤—ñ–¥—Ç–≤–æ—Ä–µ–Ω–Ω—è
                    videoBackground.play();
                    videoForProcessing.play();
                    
                    // –ü–æ–∫–∞–∑—É—î–º–æ –≤—ñ–¥–µ–æ—Ñ–æ–Ω
                    videoBackground.style.display = 'block';
                    
                    // –ó–∞–ø—É—Å–∫–∞—î–º–æ –æ–±—Ä–æ–±–∫—É –∫–∞–¥—Ä—ñ–≤
                    startProcessing();
                    
                    // –Ü–Ω—Ç–µ—Ä—Ñ–µ–π—Å
                    loading.style.display = 'none';
                    instructions.style.display = 'block';
                    isRunning = true;
                    
                    updateDebugStatus('debug-good', 'üìπ –ö–∞–º–µ—Ä–∞ –∞–∫—Ç–∏–≤–Ω–∞');
                    console.log('üìπ –ö–∞–º–µ—Ä–∞ –∑–∞–ø—É—â–µ–Ω–∞, –≤—ñ–¥–µ–æ—Ñ–æ–Ω –∞–∫—Ç–∏–≤–Ω–∏–π');
                    
                } catch (err) {
                    console.error('‚ùå –ü–æ–º–∏–ª–∫–∞ –∫–∞–º–µ—Ä–∏:', err);
                    showError('–ù–µ –≤–¥–∞–ª–æ—Å—è –∑–∞–ø—É—Å—Ç–∏—Ç–∏ –∫–∞–º–µ—Ä—É: ' + err.message);
                    updateDebugStatus('debug-bad', '‚ùå –ü–æ–º–∏–ª–∫–∞ –∫–∞–º–µ—Ä–∏');
                }
            }
            
            // ====== –û–ë–†–û–ë–ö–ê –ö–ê–î–†–Ü–í MEDIAPIPE ======
            function startProcessing() {
                function processFrame() {
                    if (!isRunning) return;
                    
                    try {
                        if (videoForProcessing.readyState >= videoForProcessing.HAVE_ENOUGH_DATA) {
                            hands.send({image: videoForProcessing});
                        }
                        requestAnimationFrame(processFrame);
                    } catch (err) {
                        console.error('–ü–æ–º–∏–ª–∫–∞ –æ–±—Ä–æ–±–∫–∏ –∫–∞–¥—Ä—É:', err);
                        updateDebugStatus('debug-bad', '‚ùå –ü–æ–º–∏–ª–∫–∞ MediaPipe');
                    }
                }
                processFrame();
            }
            
            // ====== –û–ë–†–û–ë–ö–ê –†–ï–ó–£–õ–¨–¢–ê–¢–Ü–í –†–û–ó–ü–Ü–ó–ù–ê–ù–ù–Ø ======
            function onHandResults(results) {
                if (!isRunning) return;
                
                // –û–Ω–æ–≤–ª—é—î–º–æ –ª—ñ—á–∏–ª—å–Ω–∏–∫ —Ä—É–∫
                const handCount = results.multiHandLandmarks?.length || 0;
                debugHands.textContent = handCount;
                debugHands.className = handCount > 0 ? 'debug-good' : 'debug-bad';
                
                try {
                    if (handCount > 0) {
                        const landmarks = results.multiHandLandmarks[0];
                        
                        // –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ —Ü–µ–Ω—Ç—Ä –¥–æ–ª–æ–Ω—ñ (—Ç–æ—á–∫–∏ 0, 5, 9, 13, 17)
                        const palmPoints = [landmarks[0], landmarks[5], landmarks[9], landmarks[13], landmarks[17]];
                        let avgX = 0, avgY = 0, avgZ = 0;
                        
                        palmPoints.forEach(point => {
                            avgX += point.x;
                            avgY += point.y;
                            avgZ += point.z;
                        });
                        
                        avgX /= palmPoints.length;
                        avgY /= palmPoints.length;
                        avgZ /= palmPoints.length;
                        
                        // –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –¥–ª—è Three.js
                        const x = (avgX - 0.5) * 10;   // –ó–±—ñ–ª—å—à—É—î–º–æ –¥—ñ–∞–ø–∞–∑–æ–Ω
                        const y = (0.5 - avgY) * 8;    // –Ü–Ω–≤–µ—Ä—Ç—É—î–º–æ Y
                        const z = (avgZ - 0.5) * 5;    // –ö–æ—Ä–∏–≥—É—î–º–æ –≥–ª–∏–±–∏–Ω—É
                        
                        // –û–Ω–æ–≤–ª—é—î–º–æ —ñ–Ω–¥–∏–∫–∞—Ç–æ—Ä –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç
                        debugCoords.textContent = `${x.toFixed(1)}, ${y.toFixed(1)}`;
                        
                        // –ü–ª–∞–≤–Ω–∞ –∞–Ω—ñ–º–∞—Ü—ñ—è –ø–æ–∑–∏—Ü—ñ—ó
                        glassGroup.position.lerp(new THREE.Vector3(x, y, z), 0.4);
                        glassGroup.visible = true;
                        debugGlass.textContent = '–í–∏–¥–∏–º–∏–π';
                        debugGlass.className = 'debug-good';
                        
                        // –û–±–µ—Ä—Ç–∞–Ω–Ω—è
                        glassGroup.rotation.y += 0.02;
                        
                        // –î–µ—Ç–µ–∫—Ü—ñ—è "—â–∏–ø–∫–∞"
                        const thumbTip = landmarks[4];
                        const indexTip = landmarks[8];
                        const distance = Math.sqrt(
                            Math.pow(thumbTip.x - indexTip.x, 2) +
                            Math.pow(thumbTip.y - indexTip.y, 2) +
                            Math.pow(thumbTip.z - indexTip.z, 2)
                        );
                        
                        const isPinching = distance < 0.08;
                        const now = Date.now();
                        
                        if (isPinching && now - lastPinchTime > 1000) {
                            greeting.style.display = 'block';
                            greeting.style.animation = 'none';
                            setTimeout(() => {
                                greeting.style.animation = 'fadeIn 0.5s';
                            }, 10);
                            
                            createSparkles();
                            lastPinchTime = now;
                            updateDebugStatus('debug-good', 'ü•Ç –¢–æ—Å—Ç!');
                        } else if (!isPinching) {
                            greeting.style.display = 'none';
                            updateDebugStatus('debug-good', '‚úã –†—É–∫–∞ –∑–Ω–∞–π–¥–µ–Ω–∞');
                        }
                        
                    } else {
                        // –†—É–∫–∞ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–∞
                        glassGroup.visible = false;
                        greeting.style.display = 'none';
                        debugGlass.textContent = '–ü—Ä–∏—Ö–æ–≤–∞–Ω–æ';
                        debugGlass.className = 'debug-bad';
                        debugCoords.textContent = '0, 0';
                        updateDebugStatus('debug-good', 'üîç –®—É–∫–∞—é —Ä—É–∫—É...');
                    }
                } catch (err) {
                    console.error('–ü–æ–º–∏–ª–∫–∞ –æ–±—Ä–æ–±–∫–∏ —Ä—É–∫:', err);
                    updateDebugStatus('debug-bad', '‚ùå –ü–æ–º–∏–ª–∫–∞ –æ–±—Ä–æ–±–∫–∏');
                }
            }
            
            // ====== –ï–§–ï–ö–¢ –Ü–°–ö–û–† ======
            function createSparkles() {
                const colors = ['#FFD700', '#FF6B6B', '#4ECDC4', '#FF8E53'];
                
                for (let i = 0; i < 15; i++) {
                    setTimeout(() => {
                        const sparkle = document.createElement('div');
                        const color = colors[Math.floor(Math.random() * colors.length)];
                        
                        sparkle.style.cssText = `
                            position: fixed;
                            width: ${10 + Math.random() * 20}px;
                            height: ${10 + Math.random() * 20}px;
                            background: radial-gradient(circle, ${color}, transparent);
                            border-radius: 50%;
                            pointer-events: none;
                            top: ${20 + Math.random() * 60}%;
                            left: ${Math.random() * 100}%;
                            box-shadow: 0 0 15px ${color};
                            animation: sparkle ${0.5 + Math.random()}s forwards;
                            z-index: 5;
                        `;
                        
                        document.body.appendChild(sparkle);
                        setTimeout(() => sparkle.remove(), 1000);
                    }, i * 40);
                }
            }
            
            // ====== –î–û–ü–û–ú–Ü–ñ–ù–Ü –§–£–ù–ö–¶–Ü–á ======
            function updateDebugStatus(className, text) {
                debugStatus.textContent = text;
                debugStatus.className = `debug-value ${className}`;
            }
            
            function showError(message) {
                errorDiv.innerHTML = `‚ö†Ô∏è ${message}`;
                errorDiv.style.display = 'block';
                startButton.style.display = 'block';
                loading.style.display = 'none';
            }
            
            function hideError() {
                errorDiv.style.display = 'none';
            }
            
            // ====== FPS –õ–Ü–ß–ò–õ–¨–ù–ò–ö ======
            function updateFPS() {
                frameCount++;
                const now = performance.now();
                
                if (now >= lastFpsUpdate + 1000) {
                    const fps = Math.round((frameCount * 1000) / (now - lastFpsUpdate));
                    debugFPS.textContent = fps;
                    debugFPS.className = fps > 24 ? 'debug-good' : (fps > 15 ? 'debug-value' : 'debug-bad');
                    
                    frameCount = 0;
                    lastFpsUpdate = now;
                }
                
                requestAnimationFrame(updateFPS);
            }
            
            // ====== –ê–ù–Ü–ú–ê–¶–Ü–ô–ù–ò–ô –¶–ò–ö–õ ======
            function animate() {
                requestAnimationFrame(animate);
                if (renderer && scene && camera) {
                    renderer.render(scene, camera);
                }
            }
            
            // ====== –û–ë–†–û–ë–ù–ò–ö–ò –ü–û–î–Ü–ô ======
            function setupEventListeners() {
                startButton.addEventListener('click', startCamera);
                
                window.addEventListener('resize', () => {
                    if (camera && renderer) {
                        camera.aspect = window.innerWidth / window.innerHeight;
                        camera.updateProjectionMatrix();
                        renderer.setSize(window.innerWidth, window.innerHeight);
                    }
                });
                
                // –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –Ω–∞ –¥–µ—Å–∫—Ç–æ–ø–∞—Ö
                if (window.innerWidth > 768 && !/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)) {
                    setTimeout(() => {
                        startButton.click();
                    }, 500);
                }
            }
            
            // ====== –Ü–ù–Ü–¶–Ü–ê–õ–Ü–ó–ê–¶–Ü–Ø –ü–†–ò –ó–ê–í–ê–ù–¢–ê–ñ–ï–ù–ù–Ü ======
            window.addEventListener('DOMContentLoaded', () => {
                init();
                setupEventListeners();
                animate();
                updateFPS(); // –ó–∞–ø—É—Å–∫–∞—î–º–æ FPS –ª—ñ—á–∏–ª—å–Ω–∏–∫
            });
            
        })();
    </script>
</body>
</html>
